class ElementFactory{static createHeader(){const e=document.createElement("header");return e.appendChild(this.createNavbar()),e}static createSpinner(){const e=document.createElement("div");e.id="spinnerLoad",e.className="loading-text",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.innerHTML="Loading<div id='progressMore'></div>";const t=document.createElement("div");t.id="spinnerNumber",t.className="loading-text",t.setAttribute("aria-live","polite");const n=document.createElement("div");return n.id="spinner",n.className=n.id+" loading",n.appendChild(e),n.appendChild(t),n}static createNavbar(){const e=document.createElement("nav");e.classList="navbar",e.ariaRoleDescription="Navigation bar";const t=document.createElement("h2");return t.innerText="Gposes",e.appendChild(t),e}static createRepository(){const e=document.createElement("div");return e.classList="repository",e}static createSourceFolder(e="",t="",n=""){const a=document.createElement("div");a.dataset.title=e,a.dataset.link=t,a.id=`source_${e.replace(" ","")}`,a.className="card";const s=document.createElement("div");s.classList="img-div",a.append(s);const r=document.createElement("img");r.src=n,"../assets/img/folder.png"===n&&(r.classList="folder"),s.appendChild(r),r.onload=function(){r.naturalHeight<250&&(r.classList="fullheight",s.style.display="flex",s.style.justifyContent="center")};const c=document.createElement("div");return c.classList="overlay",s.appendChild(c),a}static createPicture(e="",t="",n=""){const a=document.createElement("div");a.dataset.title=t.split("/").pop(),a.id=`picture_${t.split("/")[0].replace(" ","")}`,a.className="card";const s=document.createElement("a");s.classList="img-div",s.href=t.replace("../",e),s.target="_blank",a.append(s);const r=document.createElement("img");return r.src=n.replace("../",e),r.loading="lazy",s.appendChild(r),r.onload=function(){r.naturalHeight<250&&(r.classList="fullheight",s.style.display="flex",s.style.justifyContent="center")},a}}class Utilities{static isNsfw=!1;static setIsNsfw(){const e=new URLSearchParams(window.location.search);this.isNsfw=this.isWelcomePage()&&"true"===e.get("isNsfw")}static isWelcomePage(){return"Welcome | Gposes Xplorer"===document.title}}class FetchFactory{static async fetchSources(e){return Utilities.setIsNsfw(),await fetch(`${e}api/sources.php?isNsfw=${Utilities.isNsfw}`).then(e=>e.json()).then(e=>{if(Object.entries(e).length>0)return Object.entries(e);throw new Exception("No folder available !")}).catch(e=>console.error("Failed to fetch sources :",e.message))}static async fetchFolders(e,t){return await fetch(`${e}api/folders.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({source:t})}).then(e=>e.json()).then(e=>Object.entries(e).length>0?Object.entries(e):[]).catch(e=>console.error("Failed to fetch folders :",e.message))}static async fetchThumbnails(e,t){return await fetch(`${e}api/thumbnails.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({source:t})}).then(e=>e.json()).then(e=>Object.entries(e).length>0?Object.entries(e):[]).catch(e=>console.error("Failed to fetch folders :",e.message))}}const host="https://naslku.synology.me/gposesXplorerAPI/";async function addClickEvent(e){const t=document.querySelector(".repository");e.addEventListener("click",async function(e){t.innerHTML="";let n=e.target.parentElement.parentElement.dataset.link;const a=enableLoading();await FetchFactory.fetchFolders(host,n).then(e=>{e.length>0&&Array.from(e).forEach(e=>{let a="../assets/img/folder.png"!==e[1]?e[1].replace("../",host):e[1],s=ElementFactory.createSourceFolder(e[0],n+"/"+e[0],a);addClickEvent(s),t.appendChild(s)})}),await FetchFactory.fetchThumbnails(host,n).then(e=>{e.length>0&&Array.from(e).forEach(e=>{let n=ElementFactory.createPicture(host,e[1][0],e[1][1]);t.appendChild(n)})}),isLoading(a)&&disableLoading(a)})}function enableLoading(){null!==document.querySelector(".repository")&&(document.querySelector(".repository").style.visibility="hidden");const e=ElementFactory.createSpinner();let t=Math.random();return e.id=t,document.body.appendChild(e),t}function disableLoading(e){null!==document.querySelector(".repository")&&(document.querySelector(".repository").style.visibility="visible");document.getElementById(e).remove()}function isLoading(e){return null!==document.getElementById(e)&&void 0!==document.getElementById(e)}document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(ElementFactory.createHeader());const e=enableLoading();FetchFactory.fetchSources(host).then(t=>{if(t.length>0){const n=ElementFactory.createRepository();document.body.appendChild(n),Array.from(t).forEach(e=>{let t;t="../assets/img/folder.png"!==e[1]?e[1].replace("../",host):e[1];let a=ElementFactory.createSourceFolder(e[0].split("/")[0],e[0],t);n.appendChild(a),addClickEvent(a)}),disableLoading(e)}})});