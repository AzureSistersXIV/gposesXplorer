class ElementFactory{static createHeader(){const e=document.createElement("header");return e.appendChild(this.createNavbar()),e}static createNavbar(){const e=document.createElement("nav");e.classList="navbar",e.ariaRoleDescription="Navigation bar";const t=document.createElement("h2");return t.innerText="Gposes",e.appendChild(t),e}static createSubHeader(e=""){const t=document.createElement("h3");return t.ariaRoleDescription=`Folder header ${e}`,t.innerText=e,t}static createRepository(e=[]){const t=document.createElement("div");return t.classList="repository",e.forEach(e=>{let s=this.createFolder(e);e.includes("/")&&(s=this.createFolder(e.split("/")[0])),t.appendChild(s)}),t}static createFolder(e=""){const t=document.createElement("div");t.classList="folder",t.appendChild(this.createSubHeader(e));const s=document.createElement("div");return s.classList="folder-content",s.id=`${e}Content`,t.appendChild(s),t}static createCard(e="",t="",s=""){const c=document.createElement("div");c.className="card";const r=document.createElement("img");r.src=t;const a=document.createElement("a");return a.href=e,a.target="_blank",a.appendChild(r),c.appendChild(a),c}}class Utilities{static isNsfw=!1;static setIsNsfw(){const e=new URLSearchParams(window.location.search);this.isNsfw=this.isWelcomePage()&&"true"===e.get("isNsfw")}static isWelcomePage(){return"Welcome | Gposes"===document.title}}class FetchFactory{static async fetchFolders(e){return Utilities.setIsNsfw(),await fetch(`${e}api/folders.php?isNsfw=${Utilities.isNsfw}`).then(e=>e.json()).then(e=>{if(Object.keys(e).length>0)return document.body.appendChild(ElementFactory.createRepository(Object.keys(e))),Object.keys(e);console.error("No folder available !")}).catch(e=>console.error("Failed to fetch folders :",e.message))}static async fetchFolderContent(e,t){let s=t,c="";s.includes("/")&&(s=t.split("/")[0],c=t.split("/")[1]);try{const r=await fetch(`${e}api/content.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({folder:s,subfolder:c})}),a=await r.json(),o={};return a.folder.forEach(e=>{const s=`../screenshots/${t}/`,c=(e.startsWith(s)?e.substring(s.length):e).split("/");if(c.length>1){const e=c[0],t=c.slice(1).join("/");o[e]||(o[e]=[]),o[e].push(t)}else o._root||(o._root=[]),o._root.push(c[0])}),o}catch(e){return console.error(`Failed to fetch folder "${t}" content:`,e.message),null}}static async fetchThumbnail(e){console.warn(e)}}const host="https://naslku.synology.me/_GposesAPI/";document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(ElementFactory.createHeader()),FetchFactory.fetchFolders(host).then(e=>{e.forEach(e=>{FetchFactory.fetchFolderContent(host,e).then(t=>{let s,c=document.querySelector(`#${e.split("/")[0]}Content`);Object.entries(t).forEach(t=>{if("_root"!==t[0]){const r=document.createElement("div");r.classList="subfolder",Array.from(t[1]).forEach(c=>{FetchFactory.fetchThumbnail(`screenshots/${e}/${c}`),s=ElementFactory.createCard(`${host}screenshots/${e}/${t[0]}/${c}`,`${host}thumbnails/${e}/${t[0]}/${c}`,c),r.appendChild(s)}),c.appendChild(r)}else Array.from(t[1]).forEach(t=>{FetchFactory.fetchThumbnail(`screenshots/${e}/${t}`),s=ElementFactory.createCard(`${host}screenshots/${e}/${t}`,`${host}thumbnails/${e}/${t}`,t),c.appendChild(s)})})})})})});