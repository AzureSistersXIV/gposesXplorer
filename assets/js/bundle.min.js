class ElementFactory{static createHeader(){const e=document.createElement("header");return e.appendChild(this.createNavbar()),e}static createSpinner(){const e=document.createElement("div");e.id="spinnerLoad",e.className="loading-text",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.innerHTML="Loading<div id='progressMore'></div>";const t=document.createElement("div");t.id="spinnerNumber",t.className="loading-text",t.setAttribute("aria-live","polite");const a=document.createElement("div");return a.id="spinner",a.className=a.id+" loading",a.appendChild(e),a.appendChild(t),a}static createNavbar(){const e=document.createElement("nav");e.classList="navbar",e.ariaRoleDescription="Navigation bar";const t=document.createElement("h2");return t.innerText="Gposes",e.appendChild(t),e}static createRepository(){const e=document.createElement("div");return e.classList="repository",e}static createSourceFolder(e="",t=""){const a=document.createElement("div");a.dataset.title=e.split("/")[0],a.dataset.link=e,a.id=`source_${e.split("/")[0].replace(" ","")}`,a.className="card";const n=document.createElement("div");n.classList="img-div",a.append(n);const s=document.createElement("img");s.src=t,"../assets/img/folder.png"===t&&(s.classList="folder"),n.appendChild(s),s.onload=function(){s.naturalHeight<250&&(s.classList="fullheight",n.style.display="flex",n.style.justifyContent="center")};const c=document.createElement("div");return c.classList="overlay",n.appendChild(c),a}static createPicture(e="",t="",a=""){const n=document.createElement("div");n.dataset.title=t.split("/").pop(),n.id=`picture_${t.split("/")[0].replace(" ","")}`,n.className="card";const s=document.createElement("a");s.classList="img-div",s.href=t.replace("../",e),s.target="_blank",n.append(s);const c=document.createElement("img");return c.src=a.replace("../",e),c.loading="lazy",s.appendChild(c),c.onload=function(){c.naturalHeight<250&&(c.classList="fullheight",s.style.display="flex",s.style.justifyContent="center")},n}}class Utilities{static isNsfw=!1;static setIsNsfw(){const e=new URLSearchParams(window.location.search);this.isNsfw=this.isWelcomePage()&&"true"===e.get("isNsfw")}static isWelcomePage(){return"Welcome | Gposes Xplorer"===document.title}}class FetchFactory{static async fetchSources(e){return Utilities.setIsNsfw(),await fetch(`${e}api/sources.php?isNsfw=${Utilities.isNsfw}`).then(e=>e.json()).then(e=>{if(Object.entries(e).length>0)return Object.entries(e);throw new Exception("No folder available !")}).catch(e=>console.error("Failed to fetch sources :",e.message))}static async fetchFolders(e,t){return await fetch(`${e}api/folders.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({source:t.dataset.link})}).then(e=>e.json()).then(e=>Object.entries(e).length>0?Object.entries(e):[]).catch(e=>console.error("Failed to fetch folders :",e.message))}static async fetchThumbnails(e,t){return await fetch(`${e}api/thumbnails.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({source:t.dataset.link})}).then(e=>e.json()).then(e=>Object.entries(e).length>0?Object.entries(e):[]).catch(e=>console.error("Failed to fetch folders :",e.message))}}const host="https://naslku.synology.me/gposesXplorerAPI/";function addClickEvent(e){const t=document.querySelector(".repository");e.addEventListener("click",function(e){t.innerHTML="";const a=enableLoading();FetchFactory.fetchFolders(host,e.currentTarget).then(e=>{e.length>0&&Array.from(e).forEach(e=>{let a=ElementFactory.createSourceFolder(e[0],e[1]);addClickEvent(a),t.appendChild(a)})}),FetchFactory.fetchThumbnails(host,e.currentTarget).then(e=>{e.length>0&&(Array.from(e).forEach(e=>{let a=ElementFactory.createPicture(host,e[1][0],e[1][1]);t.appendChild(a)}),disableLoading(a))})})}function enableLoading(){const e=ElementFactory.createSpinner();let t=Math.random();return e.id=t,document.body.appendChild(e),t}function disableLoading(e){document.getElementById(e).remove()}document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(ElementFactory.createHeader());const e=enableLoading();FetchFactory.fetchSources(host).then(t=>{if(t.length>0){const a=ElementFactory.createRepository();document.body.appendChild(a),Array.from(t).forEach(e=>{let t;t="../assets/img/folder.png"!==e[1]?e[1].replace("../",host):"../assets/img/folder.png";let n=ElementFactory.createSourceFolder(e[0],t);a.appendChild(n),addClickEvent(n)}),disableLoading(e)}})});